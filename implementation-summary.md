# OpenSpec å®ç°åŸç†æ€»ç»“

æœ¬æ–‡æ¡£æ˜¯ OpenSpec æ·±åº¦æŠ€æœ¯æ–‡æ¡£çš„å¿«é€Ÿå‚è€ƒæŒ‡å—ã€‚

## ğŸ“ æ–‡æ¡£ä½ç½®

å®Œæ•´çš„æŠ€æœ¯æ–‡æ¡£ä½äº `docs/implementation/` ç›®å½•ï¼š

```
openspec-doc/implementation/
â”œâ”€â”€ README.md                          # æ–‡æ¡£ç´¢å¼•å’Œå¯¼èˆª
â”œâ”€â”€ 00-overview.md                     # æ¦‚è§ˆå’Œå‰ç½®çŸ¥è¯†
â”œâ”€â”€ 01-architecture.md                 # æ¶æ„æ€»è§ˆ
â”œâ”€â”€ 02-artifact-graph.md               # Artifact Graph ç³»ç»Ÿ
â”œâ”€â”€ 03-schema-system.md                # Schema ç³»ç»Ÿ
â”œâ”€â”€ 04-state-management.md             # çŠ¶æ€ç®¡ç†
â””â”€â”€ 05-instruction-generation.md       # æŒ‡ä»¤ç”Ÿæˆç³»ç»Ÿ
```

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µé€ŸæŸ¥

### 1. Artifact Graphï¼ˆå·¥ä»¶ä¾èµ–å›¾ï¼‰

**ä½ç½®ï¼š** `docs/implementation/02-artifact-graph.md`

**æ ¸å¿ƒæ€æƒ³ï¼š** å°†æ–‡æ¡£åˆ›å»ºè¿‡ç¨‹å»ºæ¨¡ä¸ºæœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰

**å…³é”®ç®—æ³•ï¼š**
- **æ‹“æ‰‘æ’åº** - è®¡ç®—æ„å»ºé¡ºåºï¼ˆKahn's Algorithmï¼‰
- **ä¾èµ–æ£€æµ‹** - æŸ¥æ‰¾å¯æ‰§è¡Œçš„ä¸‹ä¸€æ­¥
- **å¾ªç¯æ£€æµ‹** - DFS æ£€æµ‹ç¯

**ä»£ç ä½ç½®ï¼š** `src/core/artifact-graph/graph.ts`

```typescript
// æ ¸å¿ƒ API
graph.getBuildOrder()              // è·å–æ„å»ºé¡ºåº
graph.getNextArtifacts(completed)  // æŸ¥æ‰¾å¯æ‰§è¡Œå·¥ä»¶
graph.isComplete(completed)        // æ£€æŸ¥æ˜¯å¦å®Œæˆ
graph.getBlocked(completed)        // æŸ¥æ‰¾é˜»å¡å·¥ä»¶
```

### 2. Schema ç³»ç»Ÿ

**ä½ç½®ï¼š** `docs/implementation/03-schema-system.md`

**æ ¸å¿ƒæ€æƒ³ï¼š** å£°æ˜å¼å·¥ä½œæµå®šä¹‰

**ä¸‰å±‚è§£æä¼˜å…ˆçº§ï¼š**
```
Project-local > User-global > Package-builtin
```

**ä»£ç ä½ç½®ï¼š** `src/core/artifact-graph/schema.ts`, `resolver.ts`

```yaml
# Schema å®šä¹‰ç¤ºä¾‹
name: spec-driven
version: 1
artifacts:
  - id: proposal
    generates: proposal.md
    requires: []
  - id: specs
    requires: [proposal]
```

### 3. çŠ¶æ€ç®¡ç†

**ä½ç½®ï¼š** `docs/implementation/04-state-management.md`

**æ ¸å¿ƒæ€æƒ³ï¼š** çŠ¶æ€å³æ–‡ä»¶ï¼ˆState as Filesï¼‰

**è®¾è®¡åŸåˆ™ï¼š**
- å·¥ä»¶å®ŒæˆçŠ¶æ€ = æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- æ”¯æŒ Glob æ¨¡å¼ï¼ˆ`specs/**/*.md`ï¼‰
- æ— éœ€æ•°æ®åº“

**ä»£ç ä½ç½®ï¼š** `src/core/artifact-graph/state.ts`

```typescript
// æ ¸å¿ƒ API
detectCompleted(graph, changeDir)  // æ£€æµ‹å®ŒæˆçŠ¶æ€
loadChangeContext(...)             // åŠ è½½å˜æ›´ä¸Šä¸‹æ–‡
formatChangeStatus(context)        // æ ¼å¼åŒ–çŠ¶æ€
```

### 4. æŒ‡ä»¤ç”Ÿæˆ

**ä½ç½®ï¼š** `docs/implementation/05-instruction-generation.md`

**æ ¸å¿ƒæ€æƒ³ï¼š** ä¸º AI ç”Ÿæˆç»“æ„åŒ–æŒ‡ä»¤

**æŒ‡ä»¤ç»„æˆï¼š**
- `context` - é¡¹ç›®èƒŒæ™¯ï¼ˆçº¦æŸï¼‰
- `rules` - å·¥ä»¶è§„åˆ™ï¼ˆçº¦æŸï¼‰
- `template` - è¾“å‡ºç»“æ„
- `dependencies` - ä¾èµ–ä¿¡æ¯
- `instruction` - åˆ›å»ºæŒ‡å¯¼

**ä»£ç ä½ç½®ï¼š** `src/core/artifact-graph/instruction-loader.ts`

```typescript
// æ ¸å¿ƒ API
generateInstructions(context, artifactId)  // ç”Ÿæˆå·¥ä»¶æŒ‡ä»¤
generateApplyInstructions(...)             // ç”Ÿæˆ Apply æŒ‡ä»¤
loadTemplate(schemaName, templatePath)     // åŠ è½½æ¨¡æ¿
```

## ğŸ”„ æ•°æ®æµç¤ºä¾‹

### åˆ›å»ºæ–°å˜æ›´

```
ç”¨æˆ·: openspec new change add-auth
  â†“
CLI è§£æå’ŒéªŒè¯
  â†“
åˆ›å»ºç›®å½•: openspec/changes/add-auth/
  â†“
å†™å…¥å…ƒæ•°æ®: .openspec.yaml { schema: 'spec-driven' }
  â†“
è¾“å‡º: "Created change 'add-auth'"
```

### ç”ŸæˆæŒ‡ä»¤

```
ç”¨æˆ·: openspec instructions proposal --change add-auth
  â†“
åŠ è½½ä¸Šä¸‹æ–‡:
  â”œâ”€ è§£æ Schema
  â”œâ”€ æ„å»ºä¾èµ–å›¾
  â””â”€ æ£€æµ‹å®ŒæˆçŠ¶æ€
  â†“
ç”ŸæˆæŒ‡ä»¤:
  â”œâ”€ åŠ è½½æ¨¡æ¿
  â”œâ”€ è¯»å–é…ç½®
  â”œâ”€ æ”¶é›†ä¾èµ–
  â””â”€ ç»„è£…æŒ‡ä»¤
  â†“
è¾“å‡º: ç»“æ„åŒ–çš„ XML æ ¼å¼æŒ‡ä»¤
```

### æ£€æµ‹çŠ¶æ€

```
ç”¨æˆ·: openspec status --change add-auth
  â†“
åŠ è½½ä¸Šä¸‹æ–‡
  â†“
æ£€æµ‹å®ŒæˆçŠ¶æ€:
  â”œâ”€ æ£€æŸ¥ proposal.md æ˜¯å¦å­˜åœ¨
  â”œâ”€ æ£€æŸ¥ specs/**/*.md æ˜¯å¦æœ‰æ–‡ä»¶
  â”œâ”€ æ£€æŸ¥ design.md æ˜¯å¦å­˜åœ¨
  â””â”€ æ£€æŸ¥ tasks.md æ˜¯å¦å­˜åœ¨
  â†“
æ ¼å¼åŒ–è¾“å‡º:
  âœ“ proposal
  âœ“ specs
  â†’ design
  â—‹ tasks (blocked by: design)
```

## ğŸ—ï¸ æ¶æ„å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CLI å±‚ (Commander.js)       â”‚  â† å‘½ä»¤è§£æã€è·¯ç”±
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å‘½ä»¤å±‚ (Commands)           â”‚  â† ç”¨æˆ·äº¤äº’ã€è¾“å‡ºæ ¼å¼åŒ–
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      æ ¸å¿ƒå¼•æ“å±‚ (Core)              â”‚  â† ä¸šåŠ¡é€»è¾‘
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Artifact Graph Engine      â”‚  â”‚  â† ä¾èµ–ç®¡ç†
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Instruction Loader         â”‚  â”‚  â† æŒ‡ä»¤ç”Ÿæˆ
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æ•°æ®å±‚ (Data)               â”‚  â† æ–‡ä»¶ç³»ç»Ÿã€Schema
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š å…³é”®æŒ‡æ ‡

### æ—¶é—´å¤æ‚åº¦

| æ“ä½œ | å¤æ‚åº¦ | è¯´æ˜ |
|------|--------|------|
| æ‹“æ‰‘æ’åº | O(V + E) | V=å·¥ä»¶æ•°, E=ä¾èµ–è¾¹æ•° |
| çŠ¶æ€æ£€æµ‹ | O(V) | æ£€æŸ¥æ‰€æœ‰å·¥ä»¶ |
| ä¾èµ–æŸ¥è¯¢ | O(V Ã— D) | D=å¹³å‡ä¾èµ–æ•° |

### ç©ºé—´å¤æ‚åº¦

| æ•°æ®ç»“æ„ | å¤æ‚åº¦ |
|----------|--------|
| ä¾èµ–å›¾ | O(V + E) |
| å®ŒæˆçŠ¶æ€ | O(V) |
| æŒ‡ä»¤ç¼“å­˜ | O(1) per artifact |

## ğŸ¨ è®¾è®¡æ¨¡å¼

### 1. å·¥å‚æ¨¡å¼

```typescript
// ArtifactGraph åˆ›å»º
ArtifactGraph.fromYaml(filePath)
ArtifactGraph.fromYamlContent(content)
ArtifactGraph.fromSchema(schema)
```

### 2. é€‚é…å™¨æ¨¡å¼

```typescript
// å¤šå·¥å…·é€‚é…
interface ToolCommandAdapter {
  getFilePath(id): string
  formatFile(content): string
}
```

### 3. ç­–ç•¥æ¨¡å¼

```typescript
// ä¸åŒçš„è¾“å‡ºæ ¼å¼
printStatusText(status)      // æ–‡æœ¬æ ¼å¼
JSON.stringify(status)       // JSON æ ¼å¼
```

### 4. æ¨¡æ¿æ–¹æ³•æ¨¡å¼

```typescript
// Schema å®šä¹‰æ¨¡æ¿ï¼Œå¼•æ“æ‰§è¡Œæµç¨‹
artifacts.forEach(artifact => {
  loadTemplate(artifact.template)
  generateInstructions(artifact)
  createArtifact(artifact)
})
```

## ğŸ”§ æ‰©å±•ç‚¹

### 1. è‡ªå®šä¹‰ Schema

**ä½ç½®ï¼š** `openspec/schemas/<name>/`

**æ–‡ä»¶ï¼š**
- `schema.yaml` - å·¥ä½œæµå®šä¹‰
- `templates/` - æ¨¡æ¿æ–‡ä»¶

### 2. é¡¹ç›®é…ç½®

**ä½ç½®ï¼š** `openspec/config.yaml`

**å†…å®¹ï¼š**
- `context` - é¡¹ç›®èƒŒæ™¯
- `rules` - å·¥ä»¶è§„åˆ™

### 3. å·¥å…·é€‚é…å™¨

**ä½ç½®ï¼š** `src/core/command-generation/adapters/`

**å®ç°ï¼š** `ToolCommandAdapter` æ¥å£

## ğŸ“š å­¦ä¹ è·¯å¾„

### åˆå­¦è€…

1. é˜…è¯» [æ¶æ„æ€»è§ˆ](./implementation/01-architecture.md)
2. ç†è§£ [Artifact Graph](./implementation/02-artifact-graph.md)
3. å­¦ä¹  [Schema ç³»ç»Ÿ](./implementation/03-schema-system.md)

### è¿›é˜¶

1. æ·±å…¥ [çŠ¶æ€ç®¡ç†](./implementation/04-state-management.md)
2. æŒæ¡ [æŒ‡ä»¤ç”Ÿæˆ](./implementation/05-instruction-generation.md)
3. ç ”ç©¶æºç å®ç°

### æ‰©å±•å¼€å‘

1. åˆ›å»ºè‡ªå®šä¹‰ Schema
2. æ·»åŠ å·¥å…·é€‚é…å™¨
3. è´¡çŒ®æ ¸å¿ƒåŠŸèƒ½

## ğŸ”— ç›¸å…³èµ„æº

- **å®Œæ•´æ–‡æ¡£ï¼š** `docs/implementation/`
- **æºä»£ç ï¼š** `src/core/`
- **æµ‹è¯•ç”¨ä¾‹ï¼š** `test/core/`
- **ç”¨æˆ·æ–‡æ¡£ï¼š** `docs/`

## ğŸ’¡ å…³é”®è¦ç‚¹

1. **Artifact Graph** æ˜¯æ ¸å¿ƒ - ç†è§£å®ƒå°±ç†è§£äº†æ•´ä¸ªç³»ç»Ÿ
2. **çŠ¶æ€å³æ–‡ä»¶** - ç®€å•ä½†å¼ºå¤§çš„è®¾è®¡
3. **å£°æ˜å¼ Schema** - çµæ´»çš„å·¥ä½œæµå®šä¹‰
4. **ç»“æ„åŒ–æŒ‡ä»¤** - AI é›†æˆçš„å…³é”®
5. **é€‚é…å™¨æ¨¡å¼** - æ”¯æŒå¤šå·¥å…·çš„ç§˜è¯€

## ğŸ¯ ä¸‹ä¸€æ­¥

- è¿è¡Œé¡¹ç›®ï¼Œè·Ÿè¸ªå®Œæ•´å·¥ä½œæµ
- é˜…è¯»æºç ï¼Œç†è§£å®ç°ç»†èŠ‚
- åˆ›å»ºè‡ªå®šä¹‰ Schemaï¼Œå®è·µæ‰©å±•
- è´¡çŒ®ä»£ç ï¼Œå‚ä¸å¼€å‘

---

**å®Œæ•´æ–‡æ¡£ç´¢å¼•ï¼š** [docs/implementation/README.md](./implementation/README.md)
